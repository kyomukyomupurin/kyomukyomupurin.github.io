---
layout: post
title:  "bits/stdc++.h について"
date:   2021-02-24 19:33:16 +0900
categories: competitive-programming
---

最近競プロのテンプレで ```bits/stdc++.h``` を include しようか悩んでいた。```bits/stdc++.h``` を include するメリット、デメリットについて以下のような感じかなと考えていた。

# メリット

- いくつも include を書く必要がなく、コードがすっきりする
- include 忘れが発生しない

# デメリット

- g++ 固有のヘッダなので、例えば clang で提出することができない
- コンパイルにかかる時間が大きくなる
- 必要のないヘッダまで include するのは、美しくない
- C++ のどの機能がどのヘッダで実装されているか、を意識しないため教育上よろしくない(？)

これまで ```bits/stdc++.h``` を使わなかった大きな理由はデメリットの 2 番目、やたらと長いコンパイル時間だった。clang で提出することはほとんどないし、必要のないヘッダを include しているというのは普段のテンプレでも一緒のことだし、教育上の観点についてはそれなりに C++ に習熟しているので問題無いのではないかと思っている。

コンパイル時間が長いのはつらいなあと思いそこはかとなく include 文を書き連ねる日々を送っていたが、どうやら ```stdc++.h``` をプリコンパイルすればコンパイル時間が大幅に短くなることを先ほど知り、試してみると爆速になった。色々と注意点があるので、備忘録を残しておく。

# ```bits/stdc++.h``` のプリコンパイル

- まず ```stdc++.h``` のあるディレクトリに移動する(僕の環境だと、```/usr/include/x86_64-linux-gnu/c++/10/bits``` だった。```c++``` まではたぶん Ubuntu なら一緒)
- **普段使っているオプションをつけて** ```stdc++.h``` をコンパイルする
  - ```g++-10 -std=c++20 -O1 -DLOCAL　-fsplit-stack　stdc++.h``` みたいな感じ
- ```stdc++.h.gch``` というのができれば、OK

これでコンパイル時間が短くなる。```stdc++.h``` はできるだけ普段使っているコンパイルオプションと同じにした方がいいっぽい。例えば、```-O1``` でプリコンパイルしているのに ```-O2``` でコンパイルしようとするとセグフォしたりするのを確認した。細かいルールは把握していない。普段複数のコンパイルオプションを使いわけている場合は ```stdc++.h``` と同じディレクトリに ```stdc++.h.gch``` というディレクトリを作り、その中にそれぞれのコンパイルオプションでコンパイルしたプリコンパイル済みヘッダを(```-o``` オプションで適宜名前を変更して)入れておけば適切なものが使われる、らしい(未確認)。

# というわけで

```bits/stdc++.h``` 派に鞍替えしようと思う。僕の環境では 3.5 秒くらいコンパイル時間が短くなったので満足。なんなら include するヘッダを厳選していた頃よりも普通に速い。なんか VSCode の補完も速くなった気がする？

[これ](https://gcc.gnu.org/onlinedocs/gcc/Precompiled-Headers.html)を後でちゃんと読む。